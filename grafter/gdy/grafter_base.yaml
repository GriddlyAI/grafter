Version: "0.1"
Environment:
  Name: Grafter
  Description: Griddly port of the crafter environment from https://danijar.com/project/crafter/.
  Observers:
    Sprite2D:
      TileSize: [ 48, 48 ]
  Player:
    Count: 1
    AvatarObject: player
    Observer:
      HighlightPlayers: false
      TrackAvatar: true
      RotateWithAvatar: true
      RotateAvatarImage: false
#      Height: 9
#      Width: 9

  Levels:
    - |
      .

Actions:
  - Name: move
    InputMapping:
      Inputs:
        1:
          OrientationVector: [ -1, 0 ]
          VectorToDest: [ -1, 0 ]
          MetaData:
            image_idx: 1
        2:
          OrientationVector: [ 0, -1 ]
          VectorToDest: [ 0, -1 ]
          MetaData:
            image_idx: 2
        3:
          OrientationVector: [ 1, 0 ]
          VectorToDest: [ 1, 0 ]
          MetaData:
            image_idx: 3
        4:
          OrientationVector: [ 0, 1 ]
          VectorToDest: [ 0, 1 ]
          MetaData:
            image_idx: 4
    Behaviours:
      - Src:
          Object: player
          Commands:
            - mov: _dest
            - set_tile: meta.image_idx
        Dst:
          Object: [ grass, path, sand ]
      - Src:
          Object: player
          Commands:
            - set_tile: meta.image_idx
        Dst:
          Object: [ cow, water, stone, tree, player, zombie, skeleton, coal, lava, iron, diamond, table, furnace ]

  #  - Name: zombie_random_movement
#    InputMapping:
#      Internal: true
#    Behaviours:
#      - Src:
#          Preconditions:
#            - eq: [ is_chasing, 0 ]
#          Object: zombie
#          Commands:
#            - mov: _dest
#            - eq:
#                Arguments: [ is_chasing, 0 ]
#                Commands:
#                  - exec:
#                      Action: zombie_random_movement
#                      Delay: 10
#                      Randomize: true
#        Dst:
#          Object: [ grass, path, sand ]
#
#      - Src:
#          Object: zombie
#          Preconditions:
#            - eq: [ is_chasing, 0 ]
#          Commands:
#            - exec:
#                Action: zombie_random_movement
#                Delay: 10
#                Randomize: true
#        Dst:
#          Object: [ cow, water, stone, tree, player, zombie, skeleton, coal, lava, iron, diamond, table, furnace ]
#
  - Name: zombie_chase_player
    InputMapping:
      Internal: true
    Behaviours:
      - Src:
          Object: zombie
          Commands:
            - set: [ chase_cooldown, 0 ]
            - mov: _dest
        Dst:
          Object: [ grass, path, sand ]

  - Name: zombie_chase_proximity_trigger_off
    Trigger:
      Range: 5
      Type: RANGE_BOX_BOUNDARY
    InputMapping:
      Internal: true
    Behaviours:
      - Src:
          Object: zombie
          Commands:
            - set: [ is_chasing, 0 ]
        Dst:
          Object: player

  - Name: zombie_chase_proximity_trigger_on
    Trigger:
      Range: 4
      Type: RANGE_BOX_AREA
    InputMapping:
      Internal: true
    Behaviours:
      - Src:
          Preconditions:
           - eq: [src.chase_cooldown, 0]
          Object: zombie
          Commands:
            - set: [ is_chasing, 1 ]
            - set: [ chase_cooldown, 1 ]
            - exec:
                Action: zombie_chase_player
                Delay: 3
                Search:
                  ImpassableObjects: [ cow, water, stone, tree, zombie, skeleton, coal, lava, iron, diamond, table, furnace ]
                  TargetObjectName: player


        Dst:
          Object: player


      # Random walk for cows
  - Name: cow_random_movement
    InputMapping:
      Inputs:
        1:
          OrientationVector: [ 1, 0 ]
          VectorToDest: [ 1, 0 ]
          MetaData:
            change_image: 1
            image_idx: 1
        2:
          OrientationVector: [ 0, -1 ]
          VectorToDest: [ 0, -1 ]
          MetaData:
            change_image: 0
        3:
          OrientationVector: [ -1, 0 ]
          VectorToDest: [ -1, 0 ]
          MetaData:
            change_image: 1
            image_idx: 0
        4:
          OrientationVector: [ 0, 1 ]
          VectorToDest: [ 0, 1 ]
          MetaData:
            change_image: 0

      Internal: true
    Behaviours:

      # The butterfly moves into an empty space
      - Src:
          Object: cow
          Commands:
            - mov: _dest
            - exec:
                Action: cow_random_movement
                Delay: 1
                Randomize: true
            - eq:
                Arguments: [ meta.change_image, 1 ]
                Commands:
                  - set_tile: meta.image_idx
        Dst:
          Object: [ grass, path, sand ]

      # if the cow tries to move into anything but grass, path, sand
      - Src:
          Object: cow
          Commands:
            - exec:
                Action: cow_random_movement
                Delay: 5
                Randomize: true
        Dst:
          Object: [ _boundary, _empty, cow, water, stone, tree, player, zombie, skeleton, coal, lava, iron, diamond, table, furnace ]

Objects:
  - Name: player
    MapCharacter: p
    Z: 2
    Observers:
      Sprite2D:
        - Image: sprite2d/player.png
        - Image: sprite2d/player-left.png
        - Image: sprite2d/player-up.png
        - Image: sprite2d/player-right.png
        - Image: sprite2d/player-down.png
        - Image: sprite2d/player-sleep.png
  - Name: water
    MapCharacter: W
    Observers:
      Sprite2D:
        - Image: sprite2d/water.png
  - Name: grass
    MapCharacter: G
    Z: 1
    Observers:
      Sprite2D:
        - Image: sprite2d/grass.png
  - Name: stone
    MapCharacter: s
    Observers:
      Sprite2D:
        - Image: sprite2d/stone.png
  - Name: path
    Z: 1
    MapCharacter: P
    Observers:
      Sprite2D:
        - Image: sprite2d/path.png
  - Name: sand
    Z: 1
    MapCharacter: S
    Observers:
      Sprite2D:
        - Image: sprite2d/sand.png
  - Name: tree
    MapCharacter: T
    Observers:
      Sprite2D:
        - Image: sprite2d/tree.png
  - Name: lava
    MapCharacter: L
    Observers:
      Sprite2D:
        - Image: sprite2d/lava.png
  - Name: coal
    MapCharacter: c
    Observers:
      Sprite2D:
        - Image: sprite2d/coal.png
  - Name: iron
    MapCharacter: i
    Observers:
      Sprite2D:
        - Image: sprite2d/iron.png
  - Name: diamond
    MapCharacter: d
    Observers:
      Sprite2D:
        - Image: sprite2d/diamond.png
  - Name: table
    MapCharacter: t
    Observers:
      Sprite2D:
        - Image: sprite2d/table.png
  - Name: furnace
    MapCharacter: f
    Observers:
      Sprite2D:
        - Image: sprite2d/furnace.png

  - Name: zombie
    Z: 2
#    InitialActions:
#      - Action: zombie_random_movement
#        Randomize: true
    Variables:
      - Name: health
        InitialValue: 10
      - Name: is_chasing
        InitialValue: 0
      - Name: chase_cooldown
        InitialValue: 0
    MapCharacter: '!'
    Observers:
      Sprite2D:
        - Image: sprite2d/zombie.png
  - Name: skeleton
    Z: 2
    MapCharacter: '@'
    Observers:
      Sprite2D:
        - Image: sprite2d/skeleton.png
  - Name: cow
    InitialActions:
      - Action: cow_random_movement
        Randomize: true
    Z: 2
    MapCharacter: '#'
    Observers:
      Sprite2D:
        - Image: sprite2d/cow-left.png
        - Image: sprite2d/cow-right.png